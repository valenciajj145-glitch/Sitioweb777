<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contador Avanzado de Porcentaje</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
    .time-box {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px 40px;
      margin: 10px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      min-width: 300px;
    }
    .time-box p {
      font-size: 1.2em;
      margin: 10px 0;
    }
    span { font-weight: bold; color: #ffd700; }

    .progress-container {
      width: 90%;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      overflow: hidden;
      margin-top: 20px;
      height: 35px;
      position: relative;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      border-radius: 20px 0 0 20px;
      transition: width 0.05s linear, background-color 0.2s linear;
    }
    .indicator, .indicator-label {
      position: absolute;
      top: -25px;
      text-align: center;
      color: red;
      font-weight: bold;
      pointer-events: none;
      font-size: 0.9em;
    }
    .tooltip {
      position: absolute;
      padding: 5px 10px;
      background: rgba(0,0,0,0.7);
      border-radius: 5px;
      font-size: 0.9em;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      white-space: nowrap;
    }
    .progress-text {
      margin-top: 10px;
      font-size: 1em;
    }
    .input-section {
      margin-top: 20px;
    }
    input[type=number], input[type=datetime-local] {
      padding: 5px 10px;
      font-size: 1em;
      width: 150px;
      border-radius: 5px;
      border: none;
      margin-right: 10px;
    }
    button {
      padding: 5px 15px;
      font-size: 1em;
      border-radius: 5px;
      border: none;
      background: #ffd700;
      color: #333;
      cursor: pointer;
      font-weight: bold;
    }
    .alert {
      color: #ff4d4d;
      font-weight: bold;
      margin-top: 10px;
      display: none;
    }
    .slider-section {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Contador Avanzado de Porcentaje</h1>

  <div class="time-box">
    <p>Total: <span id="total"></span></p>
    <p>Transcurrido: <span id="elapsed"></span></p>
    <p>Restante: <span id="remaining"></span></p>
  </div>

  <div class="progress-container" id="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>
  <div class="progress-text" id="progress-text">0%</div>

  <div class="input-section">
    <input type="number" id="percentage" placeholder="%" min="0" max="100">
    <button onclick="addIndicator()">Añadir Indicador</button>
  </div>
  <p class="alert" id="alert-msg">¡Porcentaje alcanzado!</p>

  <div class="slider-section">
    <p>Simula porcentaje para cualquier fecha:</p>
    <input type="datetime-local" id="simulate-date">
    <button onclick="simulatePercentage()">Simular</button>
    <p id="simulation-result"></p>
  </div>

  <script>
    const startDate = new Date('2025-08-21T00:00:00-05:00');
    const endDate = new Date('2025-10-01T20:00:00-05:00');

    let indicators = [];

    function formatTime(ms) {
      const days = Math.floor(ms / (1000*60*60*24));
      const hours = Math.floor((ms % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((ms % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((ms % (1000*60)) / 1000);
      const milliseconds = Math.floor(ms % 1000);
      return `${days}d ${hours}h ${minutes}m ${seconds}s ${milliseconds}ms`;
    }

    function updateProgressColor(percent) {
      if(percent < 50) return '#4caf50';
      if(percent < 80) return '#ff9800';
      return '#f44336';
    }

    function updateTime() {
      const now = new Date();
      const totalMs = endDate - startDate;
      const elapsedMs = now - startDate;
      const remainingMs = endDate - now;

      document.getElementById('total').textContent = formatTime(totalMs);
      document.getElementById('elapsed').textContent = elapsedMs > 0 ? formatTime(elapsedMs) : "0d 0h 0m 0s 0ms";
      document.getElementById('remaining').textContent = remainingMs > 0 ? formatTime(remainingMs) : "0d 0h 0m 0s 0ms";

      let progressPercent = Math.min(Math.max((elapsedMs / totalMs) * 100, 0), 100);
      const progressBar = document.getElementById('progress-bar');
      progressBar.style.width = progressPercent + '%';
      progressBar.style.backgroundColor = updateProgressColor(progressPercent);
      document.getElementById('progress-text').textContent = progressPercent.toFixed(2) + '%';

      indicators.forEach(ind => {
        const left = Math.min(Math.max(ind.percent,0),100);
        ind.element.style.left = left + '%';
        ind.label.style.left = left + '%';
        if(!ind.reached && progressPercent >= ind.percent){
          ind.reached = true;
          document.getElementById('alert-msg').style.display='block';
          setTimeout(()=>{document.getElementById('alert-msg').style.display='none';},3000);
        }
        const totalMs = endDate - startDate;
        const targetMs = totalMs * (ind.percent/100);
        ind.label.textContent = `${ind.percent}%`;
        ind.label.title = `Fecha: ${new Date(startDate.getTime() + targetMs).toLocaleString('es-ES',{hour12:false})}`;
      });
    }

    function addIndicator(){
      const percentInput = parseFloat(document.getElementById('percentage').value);
      if(isNaN(percentInput) || percentInput <0 || percentInput>100){
        alert("Ingrese un porcentaje válido entre 0 y 100");
        return;
      }
      const container = document.getElementById('progress-container');
      const ind = document.createElement('div');
      ind.className='indicator';
      container.appendChild(ind);

      const label = document.createElement('div');
      label.className='indicator-label';
      container.appendChild(label);

      indicators.push({percent: percentInput, element: ind, label: label, reached:false});
      document.getElementById('percentage').value='';
    }

    function simulatePercentage(){
      const input = document.getElementById('simulate-date').value;
      if(!input){
        alert("Ingrese una fecha y hora");
        return;
      }
      const simDate = new Date(input + "-05:00");
      const totalMs = endDate - startDate;
      const elapsedMs = simDate - startDate;
      let percent = (elapsedMs/totalMs)*100;
      percent = Math.min(Math.max(percent,0),100);
      document.getElementById('simulation-result').textContent = `Porcentaje aproximado: ${percent.toFixed(2)}%`;
    }

    setInterval(updateTime,50);
    updateTime();
  </script>
</body>
</html>
